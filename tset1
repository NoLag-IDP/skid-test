task.spawn(
    function()
        -- Load required modules
        local load = require(game.ReplicatedStorage:WaitForChild("Fsys")).load
        
        set_thread_identity(2)
        local clientData = load("ClientData")
        local items = load("KindDB")
        local router = load("RouterClient")
        local downloader = load("DownloadClient")
        local animationManager = load("AnimationManager")
        local petRigs = load("new:PetRigs")
        set_thread_identity(8)

        -- Initialize pet storage
        local petModels = {}
        local pets = {}
        local equippedPet = nil
        local mountedPet = nil
        local currentMountTrack = nil

        -- Helper function to update client data
        local function updateData(key, action)
            local data = clientData.get(key)
            local clonedData = table.clone(data)
            clientData.predict(key, action(clonedData))
        end

        -- Generate unique ID for pets
        local function getUniqueId()
            local HttpService = game:GetService("HttpService")
            return HttpService:GenerateGUID(false)
        end

        -- Get pet model from cache or download
        local function getPetModel(kind)
            if petModels[kind] then
                return petModels[kind]
            end
            local streamed = downloader.promise_download_copy("Pets", kind):expect()
            petModels[kind] = streamed
            return streamed
        end

        -- Core pet creation function
        local function createPet(id, properties)
            local uniqueId = getUniqueId()
            local pet = nil

            set_thread_identity(2)
            updateData(
                "inventory",
                function(inventory)
                    local newPets = table.clone(inventory.pets)
                    local item = items[id]
                    pet = {
                        unique = uniqueId,
                        category = "pets",
                        id = id,
                        kind = item.kind,
                        newness_order = 0,
                        properties = properties
                    }
                    newPets[uniqueId] = pet
                    inventory.pets = newPets
                    return inventory
                end
            )

            set_thread_identity(8)
            pets[uniqueId] = {data = pet, model = nil}
            return pet
        end

        -- Apply neon/mega neon effects
        local function neonify(model, entry)
            local petModel = model:FindFirstChild("PetModel")
            if not petModel then
                return
            end
            for neonPart, configuration in pairs(entry.neon_parts) do
                local trueNeonPart = petRigs.get(petModel).get_geo_part(petModel, neonPart)
                trueNeonPart.Material = configuration.Material
                trueNeonPart.Color = configuration.Color
            end
        end

        -- Add pet wrapper to client data
        local function addPetWrapper(wrapper)
            updateData(
                "pet_char_wrappers",
                function(petWrappers)
                    wrapper.unique = #petWrappers + 1
                    wrapper.index = #petWrappers + 1
                    petWrappers[#petWrappers + 1] = wrapper
                    return petWrappers
                end
            )
        end

        -- Add pet state manager
        local function addPetState(state)
            updateData(
                "pet_state_managers",
                function(petStates)
                    petStates[#petStates + 1] = state
                    return petStates
                end
            )
        end

        -- Find index in array
        local function findIndex(array, finder)
            for index, value in pairs(array) do
                if finder(value, index) then
                    return index
                end
            end
            return nil
        end

        -- Remove pet wrapper
        local function removePetWrapper(uniqueId)
            updateData(
                "pet_char_wrappers",
                function(petWrappers)
                    local index =
                        findIndex(
                        petWrappers,
                        function(wrapper)
                            return wrapper.pet_unique == uniqueId
                        end
                    )
                    if not index then
                        return petWrappers
                    end
                    table.remove(petWrappers, index)
                    for wrapperIndex, wrapper in pairs(petWrappers) do
                        wrapper.unique = wrapperIndex
                        wrapper.index = wrapperIndex
                    end
                    return petWrappers
                end
            )
        end

        -- Clear pet state
        local function clearPetState(uniqueId)
            local pet = pets[uniqueId]
            if not pet or not pet.model then
                return
            end
            updateData(
                "pet_state_managers",
                function(states)
                    local index =
                        findIndex(
                        states,
                        function(state)
                            return state.char == pet.model
                        end
                    )
                    if not index then
                        return states
                    end
                    local clonedStates = table.clone(states)
                    clonedStates[index] = table.clone(clonedStates[index])
                    clonedStates[index].states = {}
                    return clonedStates
                end
            )
        end

        -- Set pet state
        local function setPetState(uniqueId, id)
            local pet = pets[uniqueId]
            if not pet or not pet.model then
                return
            end
            updateData(
                "pet_state_managers",
                function(states)
                    local index =
                        findIndex(
                        states,
                        function(state)
                            return state.char == pet.model
                        end
                    )
                    if not index then
                        return states
                    end
                    local clonedStates = table.clone(states)
                    clonedStates[index] = table.clone(clonedStates[index])
                    clonedStates[index].states = {{id = id}}
                    return clonedStates
                end
            )
        end

        -- Attach player to pet for riding
        local function attachPlayerToPet(pet)
            local character = game.Players.LocalPlayer.Character
            if not character or not character.PrimaryPart then
                return false
            end
            local ridePosition = pet:FindFirstChild("RidePosition", true)
            if not ridePosition then
                return false
            end

            local sourceAttachment = Instance.new("Attachment")
            sourceAttachment.Parent = ridePosition
            sourceAttachment.Position = Vector3.new(0, 1.237, 0)
            sourceAttachment.Name = "SourceAttachment"

            local stateConnection = Instance.new("RigidConstraint")
            stateConnection.Name = "StateConnection"
            stateConnection.Attachment0 = sourceAttachment
            stateConnection.Attachment1 = character.PrimaryPart.RootAttachment
            stateConnection.Parent = character
            return true
        end

        -- Clear player state
        local function clearPlayerState()
            updateData(
                "state_manager",
                function(state)
                    local clonedState = table.clone(state)
                    clonedState.states = {}
                    clonedState.is_sitting = false
                    return clonedState
                end
            )
        end

        -- Set player state
        local function setPlayerState(id)
            updateData(
                "state_manager",
                function(state)
                    local clonedState = table.clone(state)
                    clonedState.states = {{id = id}}
                    clonedState.is_sitting = true
                    return clonedState
                end
            )
        end

        -- Remove pet state manager
        local function removePetState(uniqueId)
            local pet = pets[uniqueId]
            if not pet or not pet.model then
                return
            end
            updateData(
                "pet_state_managers",
                function(petStates)
                    local index =
                        findIndex(
                        petStates,
                        function(state)
                            return state.char == pet.model
                        end
                    )
                    if not index then
                        return petStates
                    end
                    table.remove(petStates, index)
                    return petStates
                end
            )
        end

        -- Unmount from pet
        local function unmount(uniqueId)
            local pet = pets[uniqueId]
            if not pet or not pet.model then
                return
            end
            if currentMountTrack then
                currentMountTrack:Stop()
                currentMountTrack:Destroy()
            end
            local sourceAttachment = pet.model:FindFirstChild("SourceAttachment", true)
            if sourceAttachment then
                sourceAttachment:Destroy()
            end
            if game.Players.LocalPlayer.Character then
                for _, d in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                    if d:IsA("BasePart") and d:GetAttribute("HaveMass") then
                        d.Massless = false
                    end
                end
            end
            clearPetState(uniqueId)
            clearPlayerState()
            pet.model:ScaleTo(1)
            mountedPet = nil
        end

        -- Mount pet
        local function mount(uniqueId, playerState, petState)
            local pet = pets[uniqueId]
            if not pet or not pet.model then
                return
            end
            local player = game.Players.LocalPlayer
            if not player.Character or not player.Character.PrimaryPart then
                return
            end
            mountedPet = uniqueId
            setPetState(uniqueId, petState)
            setPlayerState(playerState)
            pet.model:ScaleTo(2)
            attachPlayerToPet(pet.model)
            currentMountTrack =
                player.Character.Humanoid.Animator:LoadAnimation(animationManager.get_track("PlayerRidingPet"))
            player.Character.Humanoid.Sit = true
            for _, d in pairs(player.Character:GetDescendants()) do
                if d:IsA("BasePart") and d.Massless == false then
                    d.Massless = true
                    d:SetAttribute("HaveMass", true)
                end
            end
            currentMountTrack:Play()
        end

        -- Fly on pet
        local function fly(uniqueId)
            mount(uniqueId, "PlayerFlyingPet", "PetBeingFlown")
        end

        -- Ride pet
        local function ride(uniqueId)
            mount(uniqueId, "PlayerRidingPet", "PetBeingRidden")
        end

        -- Unequip pet
        local function unequip(item)
            local pet = pets[item.unique]
            if not pet or not pet.model then
                return
            end
            unmount(item.unique)
            removePetWrapper(item.unique)
            removePetState(item.unique)
            pet.model:Destroy()
            pet.model = nil
            equippedPet = nil
        end

        -- Equip pet
        local function equip(item)
            if equippedPet then
                unequip(equippedPet)
            end
            local petModel = getPetModel(item.kind):Clone()
            petModel.Parent = workspace
            pets[item.unique].model = petModel
            if item.properties.neon or item.properties.mega_neon then
                neonify(petModel, items[item.kind])
            end
            equippedPet = item
            addPetWrapper(
                {
                    char = petModel,
                    mega_neon = item.properties.mega_neon,
                    neon = item.properties.neon,
                    player = game.Players.LocalPlayer,
                    entity_controller = game.Players.LocalPlayer,
                    controller = game.Players.LocalPlayer,
                    rp_name = item.properties.rp_name or "",
                    pet_trick_level = item.properties.pet_trick_level,
                    pet_unique = item.unique,
                    pet_id = item.id,
                    location = {
                        full_destination_id = "housing",
                        destination_id = "housing",
                        house_owner = game.Players.LocalPlayer
                    },
                    pet_progression = {
                        friendship_level = item.properties.friendship_level,
                        age = item.properties.age,
                        percentage = 0
                    },
                    are_colors_sealed = false,
                    is_pet = true
                }
            )
            addPetState(
                {
                    char = petModel,
                    player = game.Players.LocalPlayer,
                    store_key = "pet_state_managers",
                    is_sitting = false,
                    chars_connected_to_me = {},
                    states = {}
                }
            )
        end

        -- Mock remote functions
        local oldGet = router.get
        local function createRemoteFunctionMock(callback)
            return {
                InvokeServer = function(_, ...)
                    return callback(...)
                end
            }
        end
        local function createRemoteEventMock(callback)
            return {
                FireServer = function(_, ...)
                    return callback(...)
                end
            }
        end

        -- Create mock remotes for pet functionality
        local equipRemote =
            createRemoteFunctionMock(
            function(uniqueId, metadata)
                local pet = pets[uniqueId]
                if not pet then
                    return
                end
                equip(pet.data)
                return true, {action = "equip", is_server = true}
            end
        )
        local unequipRemote =
            createRemoteFunctionMock(
            function(uniqueId)
                local pet = pets[uniqueId]
                if not pet then
                    return
                end
                unequip(pet.data)
                return true, {action = "unequip", is_server = true}
            end
        )
        local rideRemote =
            createRemoteFunctionMock(
            function(item)
                ride(item.pet_unique)
            end
        )
        local flyRemote =
            createRemoteFunctionMock(
            function(item)
                fly(item.pet_unique)
            end
        )
        local unmountRemoteFunction =
            createRemoteFunctionMock(
            function()
                unmount(mountedPet)
            end
        )
        local unmountRemoteEvent =
            createRemoteEventMock(
            function()
                unmount(mountedPet)
            end
        )

        -- Override router to use mock remotes
        router.get = function(name)
            if name == "ToolAPI/Equip" then
                return equipRemote
            end
            if name == "ToolAPI/Unequip" then
                return unequipRemote
            end
            if name == "AdoptAPI/RidePet" then
                return rideRemote
            end
            if name == "AdoptAPI/FlyPet" then
                return flyRemote
            end
            if name == "AdoptAPI/ExitSeatStatesYield" then
                return unmountRemoteFunction
            end
            if name == "AdoptAPI/ExitSeatStates" then
                return unmountRemoteEvent
            end
            return oldGet(name)
        end

        -- Unequip any existing pets
        for _, charWrapper in pairs(clientData.get("pet_char_wrappers")) do
            oldGet("ToolAPI/Unequip"):InvokeServer(charWrapper.pet_unique)
        end

        -- Load inventory database for pet name lookup
        local Loads = require(game.ReplicatedStorage.Fsys).load
        local InventoryDB = Loads("InventoryDB")

        -- Function to get pet ID by name
        function GetPetByName(name)
            for i, v in pairs(InventoryDB.pets) do
                if v.name:lower() == name:lower() then
                    return v.id
                end
            end
            return false
        end

        -- Simple spawn function for external use
        function SpawnPet(petName, petType)
            if not petName or petName == "" then
                warn("Please enter a pet name!")
                return false, "Please enter a pet name!"
            end
            
            local petId = GetPetByName(petName)
            if not petId then
                warn("Pet not found!")
                return false, "Pet not found!"
            end
            
            local properties = {
                pet_trick_level = 0,
                rideable = true,
                flyable = true,
                friendship_level = 0,
                age = 1,
                ailments_completed = 0,
                rp_name = ""
            }
            
            if petType == "NFR" then
                properties.neon = true
            elseif petType == "MFR" then
                properties.mega_neon = true
            end
            
            local pet = createPet(petId, properties)
            
            -- Auto-equip the pet
            task.wait(0.5)
            equip(pet)
            
            return true, "Successfully spawned " .. petName .. " (" .. petType .. ")"
        end

        -- ======================
        -- SIMPLE UI CREATION
        -- ======================

        -- Create ScreenGui
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "PetSpawnerUI"
        ScreenGui.ResetOnSpawn = false
        ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

        -- Create main frame
        local MainFrame = Instance.new("Frame")
        MainFrame.Name = "MainFrame"
        MainFrame.Size = UDim2.new(0, 300, 0, 350)
        MainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
        MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        MainFrame.BorderSizePixel = 0
        MainFrame.ClipsDescendants = true
        MainFrame.Parent = ScreenGui

        -- Add corner rounding
        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 8)
        UICorner.Parent = MainFrame

        -- Add shadow effect
        local UIStroke = Instance.new("UIStroke")
        UIStroke.Color = Color3.fromRGB(60, 60, 80)
        UIStroke.Thickness = 2
        UIStroke.Parent = MainFrame

        -- Title bar
        local TitleBar = Instance.new("Frame")
        TitleBar.Name = "TitleBar"
        TitleBar.Size = UDim2.new(1, 0, 0, 40)
        TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        TitleBar.BorderSizePixel = 0
        TitleBar.Parent = MainFrame

        local TitleCorner = Instance.new("UICorner")
        TitleCorner.CornerRadius = UDim.new(0, 8)
        TitleCorner.Parent = TitleBar

        local Title = Instance.new("TextLabel")
        Title.Name = "Title"
        Title.Size = UDim2.new(1, -40, 1, 0)
        Title.Position = UDim2.new(0, 10, 0, 0)
        Title.BackgroundTransparency = 1
        Title.Text = "Pet Spawner"
        Title.TextColor3 = Color3.fromRGB(255, 255, 255)
        Title.TextSize = 18
        Title.Font = Enum.Font.GothamBold
        Title.TextXAlignment = Enum.TextXAlignment.Left
        Title.Parent = TitleBar

        -- Close button
        local CloseButton = Instance.new("TextButton")
        CloseButton.Name = "CloseButton"
        CloseButton.Size = UDim2.new(0, 30, 0, 30)
        CloseButton.Position = UDim2.new(1, -35, 0.5, -15)
        CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
        CloseButton.Text = "X"
        CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        CloseButton.TextSize = 16
        CloseButton.Font = Enum.Font.GothamBold
        CloseButton.Parent = TitleBar

        local CloseCorner = Instance.new("UICorner")
        CloseCorner.CornerRadius = UDim.new(0, 6)
        CloseCorner.Parent = CloseButton

        -- Content frame
        local Content = Instance.new("Frame")
        Content.Name = "Content"
        Content.Size = UDim2.new(1, -20, 1, -60)
        Content.Position = UDim2.new(0, 10, 0, 50)
        Content.BackgroundTransparency = 1
        Content.Parent = MainFrame

        -- Pet name input
        local NameLabel = Instance.new("TextLabel")
        NameLabel.Name = "NameLabel"
        NameLabel.Size = UDim2.new(1, 0, 0, 25)
        NameLabel.Position = UDim2.new(0, 0, 0, 0)
        NameLabel.BackgroundTransparency = 1
        NameLabel.Text = "Pet Name:"
        NameLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        NameLabel.TextSize = 14
        NameLabel.Font = Enum.Font.Gotham
        NameLabel.TextXAlignment = Enum.TextXAlignment.Left
        NameLabel.Parent = Content

        local NameBox = Instance.new("TextBox")
        NameBox.Name = "NameBox"
        NameBox.Size = UDim2.new(1, 0, 0, 35)
        NameBox.Position = UDim2.new(0, 0, 0, 25)
        NameBox.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        NameBox.BorderSizePixel = 0
        NameBox.Text = ""
        NameBox.PlaceholderText = "Enter pet name (e.g. Dragon)"
        NameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
        NameBox.TextSize = 14
        NameBox.Font = Enum.Font.Gotham
        NameBox.Parent = Content

        local NameCorner = Instance.new("UICorner")
        NameCorner.CornerRadius = UDim.new(0, 6)
        NameCorner.Parent = NameBox

        local NameStroke = Instance.new("UIStroke")
        NameStroke.Color = Color3.fromRGB(60, 60, 80)
        NameStroke.Thickness = 1
        NameStroke.Parent = NameBox

        -- Pet type dropdown
        local TypeLabel = Instance.new("TextLabel")
        TypeLabel.Name = "TypeLabel"
        TypeLabel.Size = UDim2.new(1, 0, 0, 25)
        TypeLabel.Position = UDim2.new(0, 0, 0, 70)
        TypeLabel.BackgroundTransparency = 1
        TypeLabel.Text = "Pet Type:"
        TypeLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        TypeLabel.TextSize = 14
        TypeLabel.Font = Enum.Font.Gotham
        TypeLabel.TextXAlignment = Enum.TextXAlignment.Left
        TypeLabel.Parent = Content

        local TypeButton = Instance.new("TextButton")
        TypeButton.Name = "TypeButton"
        TypeButton.Size = UDim2.new(1, 0, 0, 35)
        TypeButton.Position = UDim2.new(0, 0, 0, 95)
        TypeButton.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        TypeButton.BorderSizePixel = 0
        TypeButton.Text = "FR"
        TypeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        TypeButton.TextSize = 14
        TypeButton.Font = Enum.Font.Gotham
        TypeButton.Parent = Content

        local TypeCorner = Instance.new("UICorner")
        TypeCorner.CornerRadius = UDim.new(0, 6)
        TypeCorner.Parent = TypeButton

        local TypeStroke = Instance.new("UIStroke")
        TypeStroke.Color = Color3.fromRGB(60, 60, 80)
        TypeStroke.Thickness = 1
        TypeStroke.Parent = TypeButton

        local TypeDropdown = Instance.new("Frame")
        TypeDropdown.Name = "TypeDropdown"
        TypeDropdown.Size = UDim2.new(1, 0, 0, 0)
        TypeDropdown.Position = UDim2.new(0, 0, 0, 130)
        TypeDropdown.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        TypeDropdown.BorderSizePixel = 0
        TypeDropdown.ClipsDescendants = true
        TypeDropdown.Visible = false
        TypeDropdown.Parent = Content

        local TypeDropdownCorner = Instance.new("UICorner")
        TypeDropdownCorner.CornerRadius = UDim.new(0, 6)
        TypeDropdownCorner.Parent = TypeDropdown

        local TypeDropdownStroke = Instance.new("UIStroke")
        TypeDropdownStroke.Color = Color3.fromRGB(60, 60, 80)
        TypeDropdownStroke.Thickness = 1
        TypeDropdownStroke.Parent = TypeDropdown

        -- Type options
        local types = {"FR", "NFR", "MFR"}
        local typeButtons = {}

        for i, typeName in ipairs(types) do
            local TypeOption = Instance.new("TextButton")
            TypeOption.Name = typeName
            TypeOption.Size = UDim2.new(1, 0, 0, 35)
            TypeOption.Position = UDim2.new(0, 0, 0, (i-1) * 35)
            TypeOption.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
            TypeOption.BorderSizePixel = 0
            TypeOption.Text = typeName
            TypeOption.TextColor3 = Color3.fromRGB(255, 255, 255)
            TypeOption.TextSize = 14
            TypeOption.Font = Enum.Font.Gotham
            TypeOption.Parent = TypeDropdown
            
            TypeOption.MouseButton1Click:Connect(function()
                TypeButton.Text = typeName
                TypeDropdown.Visible = false
                TypeDropdown:TweenSize(UDim2.new(1, 0, 0, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
            end)
            
            table.insert(typeButtons, TypeOption)
        end

        -- Toggle dropdown
        TypeButton.MouseButton1Click:Connect(function()
            if TypeDropdown.Visible then
                TypeDropdown.Visible = false
                TypeDropdown:TweenSize(UDim2.new(1, 0, 0, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
            else
                TypeDropdown.Visible = true
                TypeDropdown:TweenSize(UDim2.new(1, 0, 0, 105), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
            end
        end)

        -- Spawn button
        local SpawnButton = Instance.new("TextButton")
        SpawnButton.Name = "SpawnButton"
        SpawnButton.Size = UDim2.new(1, 0, 0, 45)
        SpawnButton.Position = UDim2.new(0, 0, 1, -45)
        SpawnButton.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
        SpawnButton.BorderSizePixel = 0
        SpawnButton.Text = "SPAWN PET"
        SpawnButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        SpawnButton.TextSize = 16
        SpawnButton.Font = Enum.Font.GothamBold
        SpawnButton.Parent = Content

        local SpawnCorner = Instance.new("UICorner")
        SpawnCorner.CornerRadius = UDim.new(0, 8)
        SpawnCorner.Parent = SpawnButton

        -- Status label
        local StatusLabel = Instance.new("TextLabel")
        StatusLabel.Name = "StatusLabel"
        StatusLabel.Size = UDim2.new(1, 0, 0, 25)
        StatusLabel.Position = UDim2.new(0, 0, 1, -75)
        StatusLabel.BackgroundTransparency = 1
        StatusLabel.Text = ""
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        StatusLabel.TextSize = 13
        StatusLabel.Font = Enum.Font.Gotham
        StatusLabel.TextXAlignment = Enum.TextXAlignment.Center
        StatusLabel.Parent = Content

        -- Toggle button (to show/hide UI)
        local ToggleButton = Instance.new("TextButton")
        ToggleButton.Name = "ToggleButton"
        ToggleButton.Size = UDim2.new(0, 50, 0, 50)
        ToggleButton.Position = UDim2.new(1, -60, 0, 20)
        ToggleButton.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
        ToggleButton.Text = "PET"
        ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        ToggleButton.TextSize = 12
        ToggleButton.Font = Enum.Font.GothamBold
        ToggleButton.Visible = false
        ToggleButton.Parent = ScreenGui

        local ToggleCorner = Instance.new("UICorner")
        ToggleCorner.CornerRadius = UDim.new(0, 25)
        ToggleCorner.Parent = ToggleButton

        -- ======================
        -- UI FUNCTIONALITY
        -- ======================

        -- Make window draggable
        local dragging = false
        local dragInput, dragStart, startPos

        TitleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = MainFrame.Position
                
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)

        TitleBar.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement then
                dragInput = input
            end
        end)

        game:GetService("UserInputService").InputChanged:Connect(function(input)
            if dragging and input == dragInput then
                local delta = input.Position - dragStart
                MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)

        -- Close button functionality
        CloseButton.MouseButton1Click:Connect(function()
            MainFrame.Visible = false
            ToggleButton.Visible = true
        end)

        -- Toggle button functionality
        ToggleButton.MouseButton1Click:Connect(function()
            MainFrame.Visible = not MainFrame.Visible
            ToggleButton.Visible = not MainFrame.Visible
        end)

        -- Spawn button functionality
        SpawnButton.MouseButton1Click:Connect(function()
            local petName = NameBox.Text
            local petType = TypeButton.Text
            
            if petName == "" then
                StatusLabel.Text = "Please enter a pet name!"
                StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
                task.wait(2)
                StatusLabel.Text = ""
                return
            end
            
            StatusLabel.Text = "Spawning pet..."
            StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 200)
            
            -- Disable button during spawn
            SpawnButton.Text = "SPAWNING..."
            SpawnButton.BackgroundColor3 = Color3.fromRGB(100, 100, 150)
            SpawnButton.AutoButtonColor = false
            
            local success, message = SpawnPet(petName, petType)
            
            if success then
                StatusLabel.Text = message
                StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            else
                StatusLabel.Text = message
                StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            end
            
            -- Reset button
            task.wait(1)
            SpawnButton.Text = "SPAWN PET"
            SpawnButton.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
            SpawnButton.AutoButtonColor = true
            
            -- Clear status after 3 seconds
            task.wait(2)
            StatusLabel.Text = ""
        end)

        -- Button hover effects
        local function setupButtonHover(button, normalColor, hoverColor)
            button.MouseEnter:Connect(function()
                button.BackgroundColor3 = hoverColor
            end)
            
            button.MouseLeave:Connect(function()
                button.BackgroundColor3 = normalColor
            end)
        end

        setupButtonHover(CloseButton, Color3.fromRGB(255, 60, 60), Color3.fromRGB(255, 80, 80))
        setupButtonHover(SpawnButton, Color3.fromRGB(80, 120, 255), Color3.fromRGB(100, 140, 255))
        setupButtonHover(ToggleButton, Color3.fromRGB(80, 120, 255), Color3.fromRGB(100, 140, 255))
        setupButtonHover(TypeButton, Color3.fromRGB(40, 40, 50), Color3.fromRGB(50, 50, 60))

        -- Export public functions
        return {
            SpawnPet = SpawnPet,
            createPet = createPet,
            equip = equip,
            unequip = unequip,
            ride = ride,
            fly = fly,
            unmount = unmount,
            GetPetByName = GetPetByName,
            UI = ScreenGui
        }
    end
)
